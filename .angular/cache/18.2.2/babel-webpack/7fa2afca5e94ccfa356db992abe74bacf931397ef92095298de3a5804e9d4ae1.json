{"ast":null,"code":"import _asyncToGenerator from \"/home/jcanulao/.local/share/Trash/files/Miven1.6.0.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { SortMenuComponent } from '../sort-menu/sort-menu.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/inventory.service\";\nimport * as i2 from \"@angular/fire/compat/auth\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/forms\";\nfunction InventoryComponent_ion_item_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\")(2, \"h2\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"ion-button\", 1);\n    i0.ɵɵlistener(\"click\", function InventoryComponent_ion_item_10_Template_ion_button_click_8_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.startEditItem(item_r2));\n    });\n    i0.ɵɵtext(9, \"Editar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"ion-button\", 7);\n    i0.ɵɵlistener(\"click\", function InventoryComponent_ion_item_10_Template_ion_button_click_10_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.deleteItem(item_r2.id));\n    });\n    i0.ɵɵtext(11, \"Eliminar\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", item_r2.nombre, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"Cantidad: \", item_r2.cantidad, \" \", item_r2.unidadMedida, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Fecha de Vencimiento: \", item_r2.fechaVencimiento, \"\");\n  }\n}\nfunction InventoryComponent_ng_template_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-title\");\n    i0.ɵɵtext(3, \"Editar Cantidad\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-buttons\", 8)(5, \"ion-button\", 1);\n    i0.ɵɵlistener(\"click\", function InventoryComponent_ng_template_12_Template_ion_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.closeEditModal());\n    });\n    i0.ɵɵtext(6, \"Cerrar\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(7, \"ion-content\")(8, \"ion-item\")(9, \"ion-label\", 9);\n    i0.ɵɵtext(10, \"Nueva Cantidad\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"ion-input\", 10);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function InventoryComponent_ng_template_12_Template_ion_input_ngModelChange_11_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editItemCantidad, $event) || (ctx_r2.editItemCantidad = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"ion-button\", 11);\n    i0.ɵɵlistener(\"click\", function InventoryComponent_ng_template_12_Template_ion_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.updateItemQuantity());\n    });\n    i0.ɵɵtext(13, \"Guardar Cambios\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(11);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editItemCantidad);\n  }\n}\nfunction InventoryComponent_ion_list_13_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\")(2, \"h2\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r5.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Vence el: \", item_r5.fechaVencimiento, \"\");\n  }\n}\nfunction InventoryComponent_ion_list_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵtemplate(1, InventoryComponent_ion_list_13_ion_item_1_Template, 6, 2, \"ion-item\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.expiringItems);\n  }\n}\nexport let InventoryComponent = /*#__PURE__*/(() => {\n  var _InventoryComponent;\n  class InventoryComponent {\n    constructor(inventoryService, auth, popoverController) {\n      this.inventoryService = inventoryService;\n      this.auth = auth;\n      this.popoverController = popoverController;\n      this.inventoryItems = [];\n      this.sortedInventory = [];\n      this.expiringItems = []; // Lista de ítems por vencer\n      this.userId = null;\n      this.editItemCantidad = null; // Nueva cantidad a editar\n      this.editItemId = null; // ID del ítem que se está editando\n      this.isEditModalOpen = false;\n    }\n    ngOnInit() {\n      this.auth.user.subscribe(user => {\n        if (user) {\n          this.userId = user.uid;\n          this.loadInventory();\n        }\n      });\n      this.requestNotificationPermission(); // Solicitar permiso para notificaciones\n    }\n    // Método para cargar el inventario del usuario\n    loadInventory() {\n      if (this.userId) {\n        this.inventoryService.getInventory(this.userId).subscribe(items => {\n          this.inventoryItems = items;\n          this.sortInventory('alphabetical'); // Orden inicial\n        });\n      }\n    }\n    // Abre el menú de ordenación como popover\n    openSortMenu(ev) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const popover = yield _this.popoverController.create({\n          component: SortMenuComponent,\n          event: ev,\n          translucent: true\n        });\n        yield popover.present();\n        const {\n          data\n        } = yield popover.onDidDismiss();\n        if (data) {\n          _this.sortInventory(data); // Ordena según la selección\n        }\n      })();\n    }\n    // Método para ordenar el inventario\n    sortInventory(type) {\n      if (type === 'alphabetical') {\n        this.sortedInventory = [...this.inventoryItems].sort((a, b) => a.nombre.localeCompare(b.nombre));\n      } else if (type === 'expiration') {\n        this.sortedInventory = [...this.inventoryItems].sort((a, b) => {\n          return new Date(a.fechaVencimiento).getTime() - new Date(b.fechaVencimiento).getTime();\n        });\n      }\n    }\n    // Solicitar permiso de notificación al usuario\n    requestNotificationPermission() {\n      if ('Notification' in window) {\n        Notification.requestPermission().then(permission => {\n          if (permission === 'granted') {\n            console.log('Permiso para notificaciones otorgado');\n          } else {\n            console.log('Notificaciones bloqueadas');\n          }\n        });\n      }\n    }\n    // Enviar notificación para ítems próximos a vencer\n    sendNotification(itemName, expirationDate) {\n      if ('Notification' in window && Notification.permission === 'granted') {\n        new Notification('Producto por vencer', {\n          body: `El ítem ${itemName} vence el ${expirationDate}.`,\n          icon: 'assets/icon/alert.png' // Cambia por el ícono que prefieras\n        });\n      }\n    }\n    // Método para eliminar un ítem del inventario\n    deleteItem(itemId) {\n      if (this.userId && confirm('¿Estás seguro de que deseas eliminar este ítem del inventario?')) {\n        this.inventoryService.deleteItemFromInventory(itemId, this.userId).then(() => {\n          console.log('Ítem eliminado con éxito');\n          this.loadInventory(); // Recargar el inventario después de eliminar un ítem\n        }).catch(error => {\n          console.error('Error al eliminar el ítem:', error);\n        });\n      }\n    }\n    // Función para abrir el modal de edición y establecer el ítem que se va a editar\n    startEditItem(item) {\n      this.editItemCantidad = item.cantidad; // Establecer la cantidad actual en el campo de edición\n      this.editItemId = item.id; // Guardar el ID del ítem\n      this.isEditModalOpen = true; // Abrir el modal\n    }\n    // Función para cerrar el modal de edición\n    closeEditModal() {\n      this.isEditModalOpen = false;\n      this.editItemCantidad = null;\n      this.editItemId = null;\n    }\n    // Función para actualizar la cantidad del ítem\n    updateItemQuantity() {\n      if (this.userId && this.editItemId && this.editItemCantidad != null) {\n        this.inventoryService.updateItemQuantity(this.userId, this.editItemId, this.editItemCantidad).then(() => {\n          console.log('Cantidad actualizada con éxito');\n          this.closeEditModal(); // Cerrar el modal después de la actualización\n        }).catch(error => {\n          console.error('Error al actualizar la cantidad:', error);\n        });\n      }\n    }\n  }\n  _InventoryComponent = InventoryComponent;\n  _InventoryComponent.ɵfac = function InventoryComponent_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || _InventoryComponent)(i0.ɵɵdirectiveInject(i1.InventoryService), i0.ɵɵdirectiveInject(i2.AngularFireAuth), i0.ɵɵdirectiveInject(i3.PopoverController));\n  };\n  _InventoryComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _InventoryComponent,\n    selectors: [[\"app-inventory\"]],\n    decls: 16,\n    vars: 3,\n    consts: [[\"slot\", \"start\"], [3, \"click\"], [\"name\", \"funnel\", \"slot\", \"icon-only\"], [4, \"ngFor\", \"ngForOf\"], [3, \"isOpen\"], [4, \"ngIf\"], [\"routerLink\", \"/add-item\"], [\"color\", \"danger\", 3, \"click\"], [\"slot\", \"end\"], [\"position\", \"floating\"], [\"type\", \"number\", 3, \"ngModelChange\", \"ngModel\"], [\"expand\", \"full\", 3, \"click\"]],\n    template: function InventoryComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n        i0.ɵɵelement(3, \"ion-menu-button\");\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Inventario\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-button\", 1);\n        i0.ɵɵlistener(\"click\", function InventoryComponent_Template_ion_button_click_6_listener($event) {\n          return ctx.openSortMenu($event);\n        });\n        i0.ɵɵelement(7, \"ion-icon\", 2);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(8, \"ion-content\")(9, \"ion-list\");\n        i0.ɵɵtemplate(10, InventoryComponent_ion_item_10_Template, 12, 4, \"ion-item\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"ion-modal\", 4);\n        i0.ɵɵtemplate(12, InventoryComponent_ng_template_12_Template, 14, 1, \"ng-template\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, InventoryComponent_ion_list_13_Template, 2, 1, \"ion-list\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"ion-button\", 6);\n        i0.ɵɵtext(15, \"Agregar Item\");\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngForOf\", ctx.sortedInventory);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"isOpen\", ctx.isEditModalOpen);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.expiringItems.length > 0);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i3.IonButton, i3.IonButtons, i3.IonContent, i3.IonHeader, i3.IonIcon, i3.IonInput, i3.IonItem, i3.IonLabel, i3.IonList, i3.IonMenuButton, i3.IonTitle, i3.IonToolbar, i3.IonModal, i3.NumericValueAccessor, i3.RouterLinkDelegate, i5.RouterLink, i6.NgControlStatus, i6.NgModel]\n  });\n  return InventoryComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
import { isNumber } from "../../util";
import { $push } from "../accumulator";
import { MILLIS_PER_UNIT } from "./_internal";
<<<<<<< HEAD
<<<<<<< HEAD
function $integral(_, collection, expr, options) {
=======
const $integral = (_, collection, expr, options) => {
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
=======
const $integral = (_, collection, expr, options) => {
>>>>>>> cfa17b8e4 (favorite)
  const { input, unit } = expr.inputExpr;
  const sortKey = "$" + Object.keys(expr.parentExpr.sortBy)[0];
  const points = $push(collection, [sortKey, input], options).filter(
    ([x, y]) => isNumber(+x) && isNumber(+y)
  );
<<<<<<< HEAD
<<<<<<< HEAD
  if (points.length !== collection.length)
    return null;
=======
  if (points.length !== collection.length) return null;
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
=======
  if (points.length !== collection.length) return null;
>>>>>>> cfa17b8e4 (favorite)
  let result = 0;
  const size = collection.length;
  for (let k = 1; k < size; k++) {
    const [x1, y1] = points[k - 1];
    const [x2, y2] = points[k];
    const deltaX = (x2 - x1) / (MILLIS_PER_UNIT[unit] || 1);
    result += 0.5 * (y1 + y2) * deltaX;
  }
  return result;
<<<<<<< HEAD
<<<<<<< HEAD
}
=======
};
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
=======
};
>>>>>>> cfa17b8e4 (favorite)
export {
  $integral
};

import { isNumber } from "../../util";
import { $push } from "../accumulator";
import { withMemo } from "./_internal";
const interpolate = (x1, y1, x2, y2, x) => y1 + (x - x1) * ((y2 - y1) / (x2 - x1));
<<<<<<< HEAD
function $linearFill(_, collection, expr, options) {
=======
const $linearFill = (_, collection, expr, options) => {
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
  return withMemo(
    collection,
    expr,
    () => {
      const sortKey = "$" + Object.keys(expr.parentExpr.sortBy)[0];
      const points = $push(
        collection,
        [sortKey, expr.inputExpr],
        options
      ).filter(([x, _2]) => isNumber(+x));
<<<<<<< HEAD
      if (points.length !== collection.length)
        return null;
=======
      if (points.length !== collection.length) return null;
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
      let lindex = -1;
      let rindex = 0;
      while (rindex < points.length) {
        while (lindex + 1 < points.length && isNumber(points[lindex + 1][1])) {
          lindex++;
          rindex = lindex;
        }
        while (rindex + 1 < points.length && !isNumber(points[rindex + 1][1])) {
          rindex++;
        }
<<<<<<< HEAD
        if (rindex + 1 >= points.length)
          break;
=======
        if (rindex + 1 >= points.length) break;
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
        rindex++;
        while (lindex + 1 < rindex) {
          points[lindex + 1][1] = interpolate(
            points[lindex][0],
            points[lindex][1],
            points[rindex][0],
            points[rindex][1],
            points[lindex + 1][0]
          );
          lindex++;
        }
        lindex = rindex;
      }
      return points.map(([_2, y]) => y);
    },
    (values) => values[expr.documentNumber - 1]
  );
<<<<<<< HEAD
}
=======
};
>>>>>>> 7cb31df57 (se integro la edicion de las recetas)
export {
  $linearFill
};
